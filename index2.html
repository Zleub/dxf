<!DOCTYPE html>
<html>
<head>
<title>Test</title>
<style type="text/css">
.test
{
	display: inline-table;
}

.c_canvas
{
	border: 1px dashed red;
}

</style>
</head>

<body>
<input type="file" id="files" name="file" />

<button id="b_block_lists">show block_lists</button>

<div id="block_lists" hidden></div>
<br>

<script>
function log(object) {
	console.log(object);
}

var count1 = [];
var points = [];

var block_list = document.getElementById("block_lists");

function ft_createdxf() {
	return {
		header: [],
		classes: [],
		tables: [],
		blocks: [],
		entities: [],
		objects: [],
		thumbnailimage: []
	}
}

// function ft_create_block(style) {
// 	return {

// 	}
// }

function ft_toarray(read) {
	var pattern = /\r\n|\r|\n */g;
	var array = read.split(pattern);
	for (var i = 1; i < array.length; i++)
		array[i] = array[i].trim();
	return array;
}

function ft_toobject(dxf_array) {
	var i = 0;
	var i2 = 0;
	var dxf_object = ft_createdxf();

	while (i < dxf_array.length) {
		if (dxf_array[i] == "BLOCK") {
			tmp = dxf_object.blocks.length;
			dxf_object.blocks.push([]);
			while (dxf_array[i] != "ENDBLK") {
				dxf_object.blocks[tmp].push(dxf_array[i]);
				i += 1;
			}
		}
		i += 1;
	}
	return dxf_object;
}

function onreadend(evt) {
	if (evt.target.readyState == FileReader.DONE) {
		var array = ft_toarray(evt.target.result);
		var object = ft_toobject(array);
		test = object;

		// var i2 = 0;
		// for (var i = 1; i < array.length; i++) {
		// 	if (array[i] == "BLOCK") {
		// 		i2 = count1.length;
		// 		count1.push([]);

		// 		var div = document.createElement("div");0
		// 		div.setAttribute("class", "test");
		// 		var list = document.createElement("ul");
		// 		var canvas = document.createElement("canvas");
		// 		canvas.setAttribute("class", "c_canvas");
		// 		canvas.setAttribute("width", "1600");
		// 		canvas.setAttribute("height", "1200");

		// 		var ctx = canvas.getContext("2d");
		// 		var points_nbr = points.length;

		// 		while (array[i] != "ENDBLK") {
		// 			count1[i2].push(i.toString() + ": " + array[i - 1] + ":\t" + array[i]);
		// 			if (array[i - 1] == "10") {
		// 				points_nbr = points.length;
		// 				points.push({x1: 0, y1: 0, x2: 0, y2: 0, x3: 0, y3: 0, x4: 0, y4: 0});
		// 				points[points_nbr].x1 = array[i];
		// 			}
		// 			else if (array[i - 1] == "20") {
		// 				points[points_nbr].y1 = array[i];
		// 				ctx.fillStyle="#00FF00";
		// 				ctx.fillRect(canvas.width / 2 - points[points_nbr].x1 / 1, canvas.height / 2 - points[points_nbr].y1 / 1, 1, 1);
		// 				ctx.moveTo(canvas.width / 2 - points[points_nbr].x1 / 1, canvas.height / 2 - points[points_nbr].y1 / 1);
		// 			}
		// 			else if (array[i - 1] == "11") {
		// 				points[points_nbr].x2 = array[i];
		// 			}
		// 			else if (array[i - 1] == "21") {
		// 				points[points_nbr].y2 = array[i];
		// 				ctx.fillStyle="#FF0000";
		// 				ctx.fillRect(canvas.width / 2 - points[points_nbr].x1 / 1, canvas.height / 2 - points[points_nbr].y1 / 1, 1, 1);
		// 				ctx.lineTo(canvas.width / 2 - points[points_nbr].x2 / 1, canvas.height / 2 - points[points_nbr].y2 / 1);
		// 				ctx.stroke();
		// 			}
		// 			else if (array[i - 1] == "12") {
		// 				points[points_nbr].x3 = array[i];
		// 			}
		// 			else if (array[i - 1] == "22") {
		// 				points[points_nbr].y3 = array[i];
		// 				ctx.fillStyle="#FF0000";
		// 				ctx.fillRect(canvas.width / 2 - points[points_nbr].x3 / 10, canvas.height / 2 - points[points_nbr].y3 / 10, 1, 1);
		// 				ctx.moveTo(canvas.width / 2 - points[points_nbr].x3 / 10, canvas.height / 2 - points[points_nbr].y3 / 10);
		// 				ctx.stroke();
		// 			}
		// 			else if (array[i - 1] == "13") {
		// 				points[points_nbr].x4 = array[i];
		// 			}
		// 			else if (array[i - 1] == "23") {
		// 				points[points_nbr].y4 = array[i];
		// 				ctx.fillStyle="#FF0000";
		// 				ctx.fillRect(canvas.width / 2 - points[points_nbr].x4 / 10, canvas.height / 2 - points[points_nbr].y4 / 10, 1, 1);
		// 				ctx.lineTo(canvas.width / 2 - points[points_nbr].x4 / 10, canvas.height / 2 - points[points_nbr].y4 / 10);
		// 				ctx.stroke();
		// 			}
		// 			i += 2;
		// 		}

		// 		div.appendChild(canvas);
		// 		div.appendChild(list);
		// 		block_list.appendChild(div);
		// 	}
		// }


	// console.log(count1);
	// console.log(points);
	}
}

function listener() {
	var file = document.getElementById("files").files[0];
	var reader = new FileReader();

	reader.onloadend = onreadend;
	reader.readAsBinaryString(file);
}

function m_block_list() {
	if (block_list.hasAttribute("hidden"))
		block_list.removeAttribute("hidden");
	else
		block_list.setAttribute("hidden", "");
}

document.getElementById("files").addEventListener("change", listener);
document.getElementById("b_block_lists").addEventListener("click", m_block_list);

// var test = ft_createdxf();
// console.log(test);

</script>
</body>

</html>
