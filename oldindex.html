<!DOCTYPE html>
<html>
<head>
<title>Test</title>
<style type="text/css">
.test
{
	display: inline-table;
}

.c_canvas
{
	border: 1px dashed red;
}

</style>
</head>

<body>
<input type="file" id="files" name="file" />

<button id="b_block_lists">hidden block_lists</button>
<button id="b_canvas">hidden block_lists_canvas</button>

<div id="block_lists" hidden></div>
<br>

<!-- <canvas id="canvas"></canvas> -->

<script>
// function test()

var count1 = [];
var points = [];

var merde = document.getElementById("block_lists");

function listener() {
	var file = document.getElementById("files").files[0];
	var reader = new FileReader();

	reader.onloadend = function(evt) {
		if (evt.target.readyState == FileReader.DONE) {
			var pattern = /\r\n|\r|\n */g;
			var array = evt.target.result.split(pattern);
			for (var i = 1; i < array.length; i++) {
				array[i] = array[i].trim()
			}

			// console.log(array);

			var i2 = 0;
			for (var i = 1; i < array.length; i++) {
				// console.log(array[i]);

				if (array[i] == "BLOCK")
				{
					i2 = count1.length;
					count1.push([]);

					var div = document.createElement("div");0
					div.setAttribute("class", "test");

					var list = document.createElement("ul");

					var canvas = document.createElement("canvas");
					canvas.setAttribute("class", "c_canvas");
					canvas.setAttribute("width", "1600");
					canvas.setAttribute("height", "1200");

					var ctx = canvas.getContext("2d");
					// add element

					var points_nbr = points.length;

					while (array[i] != "ENDBLK")
					{
						count1[i2].push(i.toString() + ": " + array[i - 1] + ":\t" + array[i]);

						var elem = document.createElement("li");
						elem.innerHTML = array[i - 1] + ":&nbsp;&nbsp;" + array[i];
						// list.appendChild(elem);

						if (array[i - 1] == "10") {
							points_nbr = points.length;
							points.push({x1: 0, y1: 0, x2: 0, y2: 0, x3: 0, y3: 0, x4: 0, y4: 0});
							points[points_nbr].x1 = array[i];
						}
						else if (array[i - 1] == "20") {
							points[points_nbr].y1 = array[i];

							ctx.fillStyle="#00FF00";
							ctx.fillRect(canvas.width / 2 - points[points_nbr].x1 / 1, canvas.height / 2 - points[points_nbr].y1 / 1, 1, 1);
							ctx.moveTo(canvas.width / 2 - points[points_nbr].x1 / 1, canvas.height / 2 - points[points_nbr].y1 / 1);
						}
						else if (array[i - 1] == "11") {
							points[points_nbr].x2 = array[i];
						}
						else if (array[i - 1] == "21") {
							points[points_nbr].y2 = array[i];
							ctx.fillStyle="#FF0000";
							ctx.fillRect(canvas.width / 2 - points[points_nbr].x1 / 1, canvas.height / 2 - points[points_nbr].y1 / 1, 1, 1);
							ctx.lineTo(canvas.width / 2 - points[points_nbr].x2 / 1, canvas.height / 2 - points[points_nbr].y2 / 1);
							ctx.stroke();
						}
						// else if (array[i - 1] == "12") {
						// 	points_nbr = points.length;
						// 	points[points_nbr].x1 = array[i];
						// }
						// else if (array[i - 1] == "22") {
						// 	points[points_nbr].y1 = array[i];

						// 	ctx.fillStyle="#00FF00";
						// 	ctx.fillRect(canvas.width / 2 - points[points_nbr].x1, canvas.height / 2 - points[points_nbr].y1, 1, 1);
						// 	ctx.moveTo(canvas.width / 2 - points[points_nbr].x1, canvas.height / 2 - points[points_nbr].y1);
						// }
						else if (array[i - 1] == "13") {
							points[points_nbr].x3 = array[i];
						}
						else if (array[i - 1] == "23") {
							points[points_nbr].y3 = array[i];
							ctx.fillStyle="#FF0000";
							ctx.fillRect(canvas.width / 2 - points[points_nbr].x3 / 10, canvas.height / 2 - points[points_nbr].y3 / 10, 1, 1);
							ctx.moveTo(canvas.width / 2 - points[points_nbr].x3 / 10, canvas.height / 2 - points[points_nbr].y3 / 10);
							ctx.stroke();
						}
						else if (array[i - 1] == "14") {
							points[points_nbr].x4 = array[i];
						}
						else if (array[i - 1] == "24") {
							points[points_nbr].y4 = array[i];
							ctx.fillStyle="#FF0000";
							ctx.fillRect(canvas.width / 2 - points[points_nbr].x4 / 10, canvas.height / 2 - points[points_nbr].y4 / 10, 1, 1);
							ctx.lineTo(canvas.width / 2 - points[points_nbr].x4 / 10, canvas.height / 2 - points[points_nbr].y4 / 10);
							ctx.stroke();

						}
						i += 2;
					}
					// console.log("1: " + x1.toString() + " : " + y1.toString());
					// console.log("2: " + x2.toString() + " : " + y2.toString());
					div.appendChild(canvas);
					div.appendChild(list);

					merde.appendChild(div);

					// count1.push(i.toString() + ": " + array[i - 1] + ": " + array[i]);
				}
				// else if (array[i] == "LAYER")
				// {
				// 	i2 = count1.length;
				// 	count2.push([]);
				// 	while (array[i - 1] != "0" && array[i] != "LAYER")
				// 	{
				// 		count2[i2].push(i.toString() + ": " + array[i - 1] + ":\t" + array[i]);
				// 		i += 2;
				// 	}
				// 	// count2.push(i.toString() + ": " + array[i - 1] + ": " + array[i]);
				// }
			};
		}
		console.log(count1);
		console.log(points);
	};

	reader.readAsBinaryString(file);
}

function m_merde() {
	if (merde.hasAttribute("hidden"))
		merde.removeAttribute("hidden");
	else
		merde.setAttribute("hidden", "");
}

document.getElementById("files").addEventListener("change", listener);
document.getElementById("b_block_lists").addEventListener("click", m_merde);
</script>
</body>

</html>
