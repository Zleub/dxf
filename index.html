<!DOCTYPE html>
<html>
<head>
<title>Test</title>
<style type="text/css">
.test
{
	display: inline-table;
}

.c_canvas
{
	border: 1px dashed red;
}

</style>
</head>

<body>
<input class="test" type="file" id="files" name="file" />

<div class="test">
block[<span id="number" contenteditable>10</span>] =>
<button id="b_block">draw block</button>
</div>

<div id="block"></div>
<br>

<script src="ft_objects.js"></script>
<script src="ft_conversions.js"></script>
<script src="ft_listeners.js"></script>

<script>

function log(object) {
	console.log(object);
}

var blockElem = document.getElementById("block");
var numberElem = document.getElementById("number");

function ft_getline(lines_array, block, i) {
	var line = ft_createline();

	while (block[i].key != '0') {
		// log("ft_getline: " + block[i]);
		if (block[i].key == "10")
			line.x1 = parseInt(block[i].value);
		else if (block[i].key == "20")
			line.y1 = parseInt(block[i].value);
		else if (block[i].key == "11")
			line.x2 = parseInt(block[i].value);
		else if (block[i].key == "21")
			line.y2 = parseInt(block[i].value);
		i += 1;
	}
	lines_array.push(line);
	return i;
}

function ft_filllines(lines_array, block) {
	for (var i = 0; i < block.length; i++) {
		log(block[i]);
		if (block[i].key == '0')
			if (block[i].value == 'LINE')
				i = ft_getline(lines_array, block, i + 1) - 1;
	};
}

function ft_draw_block(canvas, block) {
	var lines_array = [];
	var ctx = canvas.getContext("2d");

	if (typeof block == "undefined") {
		log("no block");
		return
	}

	ft_filllines(lines_array, block);
	log(lines_array);
	for (var i = 0; i < lines_array.length; i++) {
		ctx.moveTo(canvas.width / 2 - lines_array[i].x1, canvas.width / 2 - lines_array[i].y1);
		ctx.lineTo(canvas.height / 2 - lines_array[i].x2, canvas.height / 2 - lines_array[i].y2);
		ctx.stroke();
		// I NEED SOME SCALE / CENTERIZATION HERE
	};
}

function ft_onreadend(evt) {
	if (evt.target.readyState == FileReader.DONE) {
		var array = ft_toarray(evt.target.result);
		object = ft_toobject(array);
	}
}

document.getElementById("files").addEventListener("change", ft_listener);
document.getElementById("number").addEventListener("input", ft_epur);
document.getElementById("b_block").addEventListener("click", ft_block);

</script>
</body>

</html>
