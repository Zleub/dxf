<!DOCTYPE html>
<html>
<head>
<title>Test</title>
</head>

<body>
<input type="file" id="files" name="file" />

<button id="h_merde">hidden merde</button>

<div id="merde" hidden></div>
<br>
<canvas id="canvas"></canvas>

<script>
// function test()

var count1 = [];
var count2 = [];
var count3 = [];

var merde = document.getElementById("merde");

function listener() {
	var file = document.getElementById("files").files[0];
	var reader = new FileReader();

	reader.onloadend = function(evt) {
		if (evt.target.readyState == FileReader.DONE) {
			var pattern = /\r\n|\r|\n */g;
			var array = evt.target.result.split(pattern);
			for (var i = 1; i < array.length; i++) {
				array[i] = array[i].trim()
			}


			console.log(array);

			pattern = /^[A-Z]+$/;

			// var list = document.createElement("ul");
			// var body = document.body;
			// body.appendChild(list);

			var i2 = 0;
			for (var i = 1; i < array.length; i++) {
				// console.log(array[i]);
				if (array[i] == "BLOCK")
				{
					i2 = count1.length;
					count1.push([]);
					var list = document.createElement("ul");
					while (array[i] != "ENDBLK")
					{
						count1[i2].push(i.toString() + ": " + array[i - 1] + ":\t" + array[i]);
						var elem = document.createElement("li");
						elem.innerHTML = array[i - 1] + ":&nbsp;&nbsp;" + array[i];
						list.appendChild(elem);
						i += 2;
					}
					merde.appendChild(list);
					// count1.push(i.toString() + ": " + array[i - 1] + ": " + array[i]);
				}
				else if (array[i] == "LAYER")
				{
					i2 = count1.length;
					count2.push([]);
					while (array[i - 1] != "0" && array[i] != "LAYER")
					{
						count2[i2].push(i.toString() + ": " + array[i - 1] + ":\t" + array[i]);
						i += 2;
					}
					// count2.push(i.toString() + ": " + array[i - 1] + ": " + array[i]);
				}
			};
		}
		console.log(count1);
		console.log(count2);
		console.log(count3);
	};

	reader.readAsBinaryString(file);
}

function m_merde() {
	if (merde.hasAttribute("hidden"))
		merde.removeAttribute("hidden");
	else
		merde.setAttribute("hidden", "");
}

document.getElementById("files").addEventListener("change", listener);
document.getElementById("h_merde").addEventListener("click", m_merde);
</script>
</body>

</html>
